services:
  buildkite-agent:
    image: buildkite/agent:3
    command: [ "start" ]
    environment:
      - BUILDKITE_AGENT_TOKEN
    volumes:
      - "../agent/startup:/docker-entrypoint.d:ro"
      - "../agent/hooks:/buildkite/hooks:ro"

  vendor:
    image: alpine
    working_dir: "/src"
    command: [ "./dist/vendor" ]
    environment:
      - ENV=development
      - SERVER_PORT=80
      - BUILDKITE_API_TOKEN
      - JWT_BUILDKITE_ORGANIZATION_SLUG
      - JWT_AUDIENCE=github-app-auth:jamestelfer
      - GITHUB_APP_PRIVATE_KEY
      - GITHUB_APP_ID
      - GITHUB_APP_INSTALLATION_ID
    volumes:
      - "..:/src"
